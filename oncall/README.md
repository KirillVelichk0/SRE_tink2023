

# HOMEWORKS
-----------------
## HOMEWORK2. 
### Список внесенных изменений.
Настроены конфиги docker(Сконфигурирован docker-compose.yml, который поднимает контейнеры Oncall, mysql, prometheus, cadvisor и victoriametrics). Для нужд oncall наружу из контейнера вытащен порт 8081:8081.

Настроены конфиги prometheus. А именно:  
- указаны url подключаемых docker контейнеров  
- создан recording rule для метрик oncall
- базовая настройка прочих параметров (таких как global scrape_interval)

Настроены конфиги oncall:  
- в поле metrics задан prometheus
- прописана конфигурация prometheus, задающая настройки oncall-notifier (на каком порте запускаться. А именно - порт 8082)

Отредактирована конфигурация nginx (daemons/nginx.conf):
- так как oncall-notifier запускается как отдельный процесс, он не может находиться на том же порте, что и oncall. Поэтому, oncall запускается на порту 8080, а notifier - 8082. При этом, nginx осуществляет routing запросов с порта 8081. Если в запросе присутствует /metrics, то nginx проксирует на порт 8082. Иначе - на порт 8080. Как уже упомяналось ранее, порт 8081 - наружный.

Перечисленных выше мер достаточно, чтобы prometheus мог получать метрики. Но, так как на семинаре также было сказано показать использование promQL и написать recording rule:  
- в папке promQL можно увидеть текстовый файл с несколькими примерами запросов и пояснениями к ним. Также, promQL был использован в recording rule.
- создан recording rule oncall:some_weird_oncall_metric:rate_sent_div_blackhole. Описание данного правила можно увидеть в файле prometheus/some_rule.yml. Данное правило рассчитывается на основе стандартных метрик, посылаемых oncall-ом (довольно странных).

В проекте используются только заданные преподавателем внешние порты, что гарантирует нормальный запуск контейнеров на машине с настроенным прокси-сервером.

Для запуска просто напишите docker compose up. 
